# ğŸš€ æ–°åŠŸèƒ½æ›´æ–°ï¼šä½“ç´ é‡‡æ ·å’Œä¸Šé‡‡æ ·

æœ¬æ¬¡æ›´æ–°ä¸º Coarse2Fine-PCGen é¡¹ç›®æ·»åŠ äº†ä¸¤ä¸ªé‡è¦çš„æ–°åŠŸèƒ½ï¼š

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. ğŸ“¦â¡ï¸â˜ï¸ ä½“ç´ é‡‡æ ·å›ç‚¹äº‘ (Voxel-to-Points Sampling)

å°†ç”Ÿæˆçš„ä½“ç´ ç½‘æ ¼é‡æ–°é‡‡æ ·ä¸ºç‚¹äº‘æ•°æ®ï¼Œæ”¯æŒï¼š

- **è‡ªå®šä¹‰ç‚¹æ•°**ï¼šå¯æŒ‡å®šç›®æ ‡ç‚¹æ•°æˆ–ä½¿ç”¨æ‰€æœ‰è¶…è¿‡é˜ˆå€¼çš„ä½“ç´ 
- **å¤šç§é‡‡æ ·æ–¹æ³•**ï¼š
  - `center`: ä½“ç´ ä¸­å¿ƒé‡‡æ ·
  - `random`: ä½“ç´ å†…éšæœºé‡‡æ ·  
  - `weighted`: åŸºäºä½“ç´ å€¼çš„åŠ æƒæ¦‚ç‡é‡‡æ ·
- **å¯è°ƒé˜ˆå€¼**ï¼šçµæ´»æ§åˆ¶é‡‡æ ·çš„ä½“ç´ èŒƒå›´

### 2. ğŸ” ä½“ç´ ä¸Šé‡‡æ · (Voxel Upsampling)

æå‡ä½“ç´ ç½‘æ ¼åˆ†è¾¨ç‡ï¼Œæ”¯æŒï¼š

- **ä»»æ„å€æ•°ç¼©æ”¾**ï¼šå¦‚ 2x, 4x ç­‰
- **å¤šç§æ’å€¼æ–¹æ³•**ï¼š
  - `linear`: çº¿æ€§æ’å€¼ï¼ˆå¹³æ»‘ï¼‰
  - `nearest`: æœ€è¿‘é‚»æ’å€¼ï¼ˆä¿æŒåŸå€¼ï¼‰
  - `cubic`: ä¸‰æ¬¡æ’å€¼ï¼ˆæœ€å¹³æ»‘ï¼‰

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç±»æ–¹æ³•æ‰©å±•

**`PointCloudToVoxel` ç±»æ–°å¢æ–¹æ³•ï¼š**

```python
# ä½“ç´ é‡‡æ ·å›ç‚¹äº‘
voxel_to_points(voxel_grid, threshold=0.5, num_points=None, method='center')

# ä½“ç´ ä¸Šé‡‡æ ·
upsample_voxel_grid(voxel_grid, scale_factor=2.0, method='linear')

# ç‚¹äº‘ä¿å­˜
save_point_cloud(point_cloud, output_path, format='txt')
```

### å‘½ä»¤è¡Œæ¥å£æ‰©å±•

**æ–°å¢å‚æ•°ï¼š**

```bash
# ä½“ç´ é‡‡æ ·å‚æ•°
--sample-back                    # å¯ç”¨é‡‡æ ·åŠŸèƒ½
--sample-num-points INT          # ç›®æ ‡ç‚¹æ•°
--sample-threshold FLOAT         # ä½“ç´ é˜ˆå€¼
--sample-method {center,random,weighted}  # é‡‡æ ·æ–¹æ³•

# ä½“ç´ ä¸Šé‡‡æ ·å‚æ•°
--upsample                       # å¯ç”¨ä¸Šé‡‡æ ·
--upsample-factor FLOAT          # æ”¾å¤§å€æ•°
--upsample-method {linear,nearest,cubic}  # æ’å€¼æ–¹æ³•
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

1. **è´¨é‡è¯„ä¼°**: å°†ç”Ÿæˆçš„ä½“ç´ è½¬å›ç‚¹äº‘ï¼Œä¸åŸå§‹æ•°æ®å¯¹æ¯”
2. **æ•°æ®å¢å¼º**: é€šè¿‡ä¸Šé‡‡æ ·è·å¾—æ›´é«˜åˆ†è¾¨ç‡çš„ä½“ç´ è¡¨ç¤º
3. **å¯è§†åŒ–**: ç”Ÿæˆä¸åŒå¯†åº¦çš„ç‚¹äº‘ç”¨äºå±•ç¤º
4. **åå¤„ç†**: å¯¹ç”Ÿæˆç»“æœè¿›è¡Œç²¾ç»†åŒ–å¤„ç†

## ğŸ“– å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```bash
# ä½“ç´ é‡‡æ ·å›ç‚¹äº‘
python scripts/test_conversion.py --input data/sample.h5 --output result.tiff \
    --sample-back --sample-num-points 10000 --sample-method weighted

# ä½“ç´ ä¸Šé‡‡æ ·
python scripts/test_conversion.py --input data/sample.h5 --output result.tiff \
    --upsample --upsample-factor 2.0 --upsample-method linear
```

### å®Œæ•´æµç¨‹

```bash
# ç‚¹äº‘â†’ä½“ç´ â†’ä¸Šé‡‡æ ·â†’é‡‡æ ·å›ç‚¹äº‘
python scripts/test_conversion.py --input data/sample.h5 --output full_result.tiff \
    --method gaussian --sigma 1.5 \
    --upsample --upsample-factor 2.0 \
    --sample-back --sample-num-points 50000 --sample-method random
```

### æ¼”ç¤ºè„šæœ¬

```bash
# è¿è¡Œæ¼”ç¤ºè„šæœ¬æŸ¥çœ‹æ‰€æœ‰æ–°åŠŸèƒ½
python scripts/demo_new_features.py
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶

è¿è¡Œåä¼šç”Ÿæˆï¼š

- `result.tiff`: åŸå§‹ä½“ç´ ç½‘æ ¼
- `result_upsampled.tiff`: ä¸Šé‡‡æ ·çš„ä½“ç´ ç½‘æ ¼ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- `result_sampled.csv`: é‡‡æ ·çš„ç‚¹äº‘ï¼ˆCSVæ ¼å¼ï¼Œè¡¨å¤´: "x [nm],y [nm],z [nm]"ï¼‰
- `result_info.txt`: è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯å’Œå‚æ•°è®°å½•

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

- **å†…å­˜ä½¿ç”¨**: ä¸Šé‡‡æ ·ä¼šæŒ‰å€æ•°çš„ä¸‰æ¬¡æ–¹å¢åŠ å†…å­˜éœ€æ±‚
- **å¤„ç†æ—¶é—´**: ä¸ç›®æ ‡åˆ†è¾¨ç‡å’Œç‚¹æ•°æˆæ­£æ¯”
- **å»ºè®®**: å¯¹å¤§æ•°æ®é›†ä½¿ç”¨é€‚ä¸­çš„ä¸Šé‡‡æ ·å€æ•°ï¼ˆå¦‚2.0-4.0ï¼‰

## ğŸ“š æ–‡æ¡£

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š
- [ä½“ç´ é‡‡æ ·å’Œä¸Šé‡‡æ ·åŠŸèƒ½è¯´æ˜](docs/voxel_sampling_upsampling.md)
- [æ¼”ç¤ºè„šæœ¬](scripts/demo_new_features.py)

## ğŸ”§ ä»£ç è´¨é‡

- âœ… å®Œæ•´çš„ç±»å‹æ³¨è§£
- âœ… è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… å‚æ•°éªŒè¯
- âœ… å…¼å®¹åŸæœ‰API

---

ğŸ’¡ **æç¤º**: è¿™äº›æ–°åŠŸèƒ½å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œä¸ºç‚¹äº‘ç”Ÿæˆå·¥ä½œæµæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚
