---
alwaysApply: true
description: 项目结构和架构指南
---

# Coarse2Fine-PCGen 项目结构指南

这是一个基于体素表示的粗到精点云生成框架，旨在突破传统点云生成网络的点数限制。

## 核心架构

项目采用模块化设计，分为以下主要组件：

1. **数据处理层** ([src/data/](mdc:src/data/))
   - [h5_loader.py](mdc:src/data/h5_loader.py): HDF5格式点云数据加载器
   - 负责处理shape为(样本数, 点数, 3)的点云数据

2. **体素转换层** ([src/voxel/](mdc:src/voxel/))
   - [converter.py](mdc:src/voxel/converter.py): 点云到体素网格的转换器
   - 支持占有网格、密度网格、高斯密度等多种体素化方法

3. **模型层** ([src/models/](mdc:src/models/))
   - [diffusion_3d.py](mdc:src/models/diffusion_3d.py): 3D扩散模型实现
   - [diffusion_lightning.py](mdc:src/models/diffusion_lightning.py): PyTorch Lightning训练框架
   - 包含体素生成网络和点云精细化网络

4. **工具层** ([src/utils/](mdc:src/utils/))
   - 可视化和辅助工具

## 工作流程

1. **点云→体素映射**: 使用PointCloudToVoxel将点云转换为3D体素表示
2. **体素生成网络**: 训练生成式网络生成3D体素
3. **体素→点云采样**: 将生成的体素重新采样为点云
4. **精细化网络**: 使用PointNet++等网络进行逐点微调

## 脚本入口点

### 体素转换相关 ([scripts/test_conversion/](mdc:scripts/test_conversion/))

- [test_conversion.py](mdc:scripts/test_conversion/test_conversion.py): 主要的体素转换测试脚本
- [create_sample_data.py](mdc:scripts/test_conversion/create_sample_data.py): 生成测试数据
- [demo_new_features.py](mdc:scripts/test_conversion/demo_new_features.py): 新功能演示

### 3D扩散模型相关 ([scripts/3d_diffusion/](mdc:scripts/3d_diffusion/))

- [train_diffusion.py](mdc:scripts/3d_diffusion/train_diffusion.py): 扩散模型训练脚本
- [generate_samples.py](mdc:scripts/3d_diffusion/generate_samples.py): 样本生成脚本
- [test_diffusion_system.py](mdc:scripts/3d_diffusion/test_diffusion_system.py): 扩散系统测试
- [run_example.py](mdc:scripts/3d_diffusion/run_example.py): 运行示例

### 单元测试

- [tests/](mdc:tests/) 目录下的测试文件

## 数据格式要求

- 输入: H5文件，包含shape为(样本数, 点数, 3)的点云数据
- 中间表示: 3D体素网格
- 输出: 高质量点云数据